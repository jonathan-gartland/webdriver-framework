"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.tellReporter = exports.ignoredHooks = exports.isEmpty = exports.getTestStatus = void 0;

var _process = _interopRequireDefault(require("process"));

var _constants = require("./constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Get allure test status by TestStat object
 * @param test {Object} - TestStat object
 * @param config {Object} - wdio config object
 * @private
 */
const getTestStatus = (test, config) => {
  if (config.framework === 'jasmine') {
    return _constants.testStatuses.FAILED;
  }

  if (test.error.name) {
    return test.error.name === 'AssertionError' ? _constants.testStatuses.FAILED : _constants.testStatuses.BROKEN;
  }

  const stackTrace = test.error.stack.trim();
  return stackTrace.startsWith('AssertionError') ? _constants.testStatuses.FAILED : _constants.testStatuses.BROKEN;
};
/**
 * Check is object is empty
 * @param object {Object}
 * @private
 */


exports.getTestStatus = getTestStatus;

const isEmpty = object => !object || Object.keys(object).length === 0;
/**
 * Filter unnecessary mocha hooks
 * @param title {String} - hook title
 * @returns {boolean}
 * @private
 */


exports.isEmpty = isEmpty;

const ignoredHooks = title => _constants.mochaIgnoredHooks.some(hook => title.includes(hook));
/**
 * Call reporter
 * @param {string} event  - event name
 * @param {Object} msg - event payload
 * @private
 */


exports.ignoredHooks = ignoredHooks;

const tellReporter = (event, msg = {}) => {
  _process.default.emit(event, msg);
};

exports.tellReporter = tellReporter;